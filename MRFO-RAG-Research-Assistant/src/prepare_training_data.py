"""
å‡†å¤‡MRFOé¢†åŸŸçš„å¾®è°ƒæ•°æ®
"""
import json
from typing import List, Dict


class TrainingDataPreparer:
    def __init__(self):
        self.training_data = []

    def add_qa_pair(
            self,
            instruction: str,
            input_text: str = "",
            output: str = ""
    ):
        """
        æ·»åŠ ä¸€ä¸ªQAå¯¹

        Args:
            instruction: æŒ‡ä»¤/é—®é¢˜
            input_text: é¢å¤–è¾“å…¥(å¯é€‰)
            output: æœŸæœ›çš„å›ç­”
        """
        self.training_data.append({
            "instruction": instruction,
            "input": input_text,
            "output": output
        })

    def save(self, filepath: str):
        """ä¿å­˜ä¸ºJSON"""
        with open(filepath, 'w', encoding='utf-8') as f:
            json.dump(self.training_data, f, ensure_ascii=False, indent=2)
        print(f"âœ… å·²ä¿å­˜ {len(self.training_data)} æ¡è®­ç»ƒæ•°æ®åˆ° {filepath}")

    def show_stats(self):
        """æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯"""
        print(f"\nğŸ“Š è®­ç»ƒæ•°æ®ç»Ÿè®¡:")
        print(f"   æ€»æ¡æ•°: {len(self.training_data)}")

        total_chars = sum(
            len(item['instruction']) + len(item['output'])
            for item in self.training_data
        )
        avg_chars = total_chars // len(self.training_data) if self.training_data else 0
        print(f"   å¹³å‡é•¿åº¦: {avg_chars} å­—ç¬¦")

        print(f"\nğŸ“‹ å‰3æ¡ç¤ºä¾‹:")
        for i, item in enumerate(self.training_data[:3], 1):
            print(f"\n   [{i}] é—®é¢˜: {item['instruction'][:50]}...")
            print(f"       ç­”æ¡ˆ: {item['output'][:80]}...")


def create_mrfo_dataset():
    """
    åˆ›å»ºMRFOé¢†åŸŸçš„è®­ç»ƒæ•°æ®é›†
    """
    print("=" * 70)
    print("ğŸ“ å‡†å¤‡MRFOé¢†åŸŸè®­ç»ƒæ•°æ®")
    print("=" * 70)

    preparer = TrainingDataPreparer()

    # ========== åŸºç¡€æ¦‚å¿µç±» ==========
    print("\nğŸ“š æ·»åŠ åŸºç¡€æ¦‚å¿µ...")

    preparer.add_qa_pair(
        instruction="ä»€ä¹ˆæ˜¯MRFOç®—æ³•?",
        output="""MRFO(Manta Ray Foraging Optimization,è é²¼è§…é£Ÿä¼˜åŒ–)ç®—æ³•æ˜¯ä¸€ç§å…ƒå¯å‘å¼ä¼˜åŒ–ç®—æ³•ã€‚
å®ƒé€šè¿‡æ¨¡æ‹Ÿè é²¼çš„è§…é£Ÿè¡Œä¸ºæ¥æœç´¢æœ€ä¼˜è§£,åŒ…æ‹¬ä¸‰ç§ç­–ç•¥:é“¾å¼è§…é£Ÿã€èºæ—‹è§…é£Ÿå’Œç¿»æ»šè§…é£Ÿã€‚
è¯¥ç®—æ³•å…·æœ‰å…¨å±€æ¢ç´¢èƒ½åŠ›å¼ºã€æ”¶æ•›é€Ÿåº¦å¿«çš„ç‰¹ç‚¹ã€‚"""
    )

    preparer.add_qa_pair(
        instruction="MRFOç®—æ³•çš„ä¸‰ç§è§…é£Ÿç­–ç•¥æ˜¯ä»€ä¹ˆ?",
        output="""MRFOç®—æ³•åŒ…å«ä¸‰ç§è§…é£Ÿç­–ç•¥:
1. é“¾å¼è§…é£Ÿ(Chain Foraging): è é²¼æœç€æµ®æ¸¸ç”Ÿç‰©æµ“åº¦æœ€é«˜çš„ä½ç½®ç§»åŠ¨,ç§ç¾¤ä¸­æ¯ä¸ªä¸ªä½“æ ¹æ®æœ€ä¼˜ä½ç½®è¿›è¡Œæ›´æ–°ã€‚
2. èºæ—‹è§…é£Ÿ(Cyclone Foraging): è é²¼ä»¥èºæ—‹æ–¹å¼ç»•æœ€ä¼˜ä½ç½®è§…é£Ÿ,å¢å¼ºå±€éƒ¨å¼€å‘èƒ½åŠ›ã€‚
3. ç¿»æ»šè§…é£Ÿ(Somersault Foraging): è é²¼åœ¨è§…é£ŸåŒºåŸŸç¿»æ»š,å¸®åŠ©ç®—æ³•è·³å‡ºå±€éƒ¨æœ€ä¼˜ã€‚"""
    )

    preparer.add_qa_pair(
        instruction="å…ƒå¯å‘å¼ç®—æ³•æ˜¯ä»€ä¹ˆ?",
        output="""å…ƒå¯å‘å¼ç®—æ³•æ˜¯ä¸€ç±»ç”¨äºè§£å†³å¤æ‚ä¼˜åŒ–é—®é¢˜çš„ç®—æ³•,å®ƒä»¬æ¨¡æ‹Ÿè‡ªç„¶ç•Œæˆ–ç‰©ç†ç°è±¡æ¥å¯»æ‰¾æœ€ä¼˜è§£ã€‚
å¸¸è§çš„å…ƒå¯å‘å¼ç®—æ³•åŒ…æ‹¬é—ä¼ ç®—æ³•(GA)ã€ç²’å­ç¾¤ä¼˜åŒ–(PSO)ã€è é²¼è§…é£Ÿä¼˜åŒ–(MRFO)ç­‰ã€‚
è¿™ç±»ç®—æ³•ä¸éœ€è¦é—®é¢˜çš„æ¢¯åº¦ä¿¡æ¯,é€‚ç”¨äºè¿ç»­å’Œç¦»æ•£ä¼˜åŒ–é—®é¢˜ã€‚"""
    )

    # ========== DLM MRFOæ”¹è¿›ç­–ç•¥ç±» ==========
    print("ğŸ”§ æ·»åŠ æ”¹è¿›ç­–ç•¥...")

    preparer.add_qa_pair(
        instruction="DLM MRFOç®—æ³•æ˜¯ä»€ä¹ˆ?",
        output="""DLM MRFO(Discrete Long-term Memory Manta Ray Foraging Optimization,ç¦»æ•£é•¿æ—¶è®°å¿†è é²¼è§…é£Ÿä¼˜åŒ–)æ˜¯MRFOç®—æ³•çš„æ”¹è¿›ç‰ˆæœ¬ã€‚
å®ƒé’ˆå¯¹é«˜ç»´ç¦»æ•£è°ƒåº¦é—®é¢˜,å¼•å…¥äº†ä»¥ä¸‹æ”¹è¿›æœºåˆ¶:
1. ç¦»æ•£ä½ç½®æ›´æ–°ç­–ç•¥
2. åŠ¨æ€æƒé‡æœºåˆ¶
3. é•¿æ—¶è®°å¿†æœºåˆ¶
4. å˜å¼‚æ“ä½œ
5. PAR(å³°å€¼å¹³å‡æ¯”)ä¸“é¡¹ä¼˜åŒ–ç­–ç•¥"""
    )

    preparer.add_qa_pair(
        instruction="DLM MRFOçš„ç¦»æ•£ä½ç½®æ›´æ–°ç­–ç•¥æ˜¯ä»€ä¹ˆ?",
        output="""ç¦»æ•£ä½ç½®æ›´æ–°ç­–ç•¥ç”¨äºå¢å¼ºç®—æ³•åœ¨ç¦»æ•£è§£ç©ºé—´çš„æ¢ç´¢èƒ½åŠ›ã€‚
å®ƒä¸»è¦åŒ…å«ä¸¤ä¸ªæœºåˆ¶:
1. åŠ¨æ€è½¬ç§»æœºåˆ¶: æ ¹æ®è§¦å‘æ¡ä»¶å†³å®šæ˜¯å¦è¿›è¡Œä½ç½®è½¬ç§»
2. åˆ†çº§è½¬ç§»æœºåˆ¶: æ ¹æ®é€‚åº”åº¦å·®å¼‚è¿›è¡Œåˆ†çº§çš„ä½ç½®æ›´æ–°
è¿™ç§ç­–ç•¥ä½¿ç®—æ³•æ›´é€‚åˆå¤„ç†å®¶åº­èƒ½æºè°ƒåº¦ç­‰ç¦»æ•£ä¼˜åŒ–é—®é¢˜ã€‚"""
    )

    preparer.add_qa_pair(
        instruction="ä»€ä¹ˆæ˜¯é•¿æ—¶è®°å¿†æœºåˆ¶?",
        output="""é•¿æ—¶è®°å¿†æœºåˆ¶æ˜¯DLM MRFOå¼•å…¥çš„é‡è¦æ”¹è¿›,ç”¨äºæé«˜ç®—æ³•çš„å…¨å±€æ¢ç´¢èƒ½åŠ›ã€‚
å®ƒç»´æŠ¤ä¸€ä¸ªè®°å¿†åº“,å­˜å‚¨å†å²æœ€ä¼˜è§£å’Œå¤šæ ·æ€§è§£ã€‚
åœ¨è¿­ä»£è¿‡ç¨‹ä¸­,ç®—æ³•å¯ä»¥ä»è®°å¿†åº“ä¸­è·å–ä¿¡æ¯,é¿å…é™·å…¥å±€éƒ¨æœ€ä¼˜,æé«˜æœç´¢æ•ˆç‡ã€‚"""
    )

    preparer.add_qa_pair(
        instruction="DLM MRFOçš„åŠ¨æ€æƒé‡æœºåˆ¶æœ‰ä»€ä¹ˆä½œç”¨?",
        output="""åŠ¨æ€æƒé‡æœºåˆ¶ç”¨äºå¹³è¡¡æˆæœ¬å’ŒPAR(å³°å€¼å¹³å‡æ¯”)ä¸¤ä¸ªä¼˜åŒ–ç›®æ ‡çš„ä¼˜å…ˆçº§ã€‚
åœ¨è¿­ä»£è¿‡ç¨‹ä¸­,æƒé‡ä¼šåŠ¨æ€è°ƒæ•´:
- æˆæœ¬æƒé‡: Ï‰1 = 0.7 - 0.2 Ã— (iter / maxIter)
- PARæƒé‡: Ï‰2 = 1 - Ï‰1
è¿™æ ·å¯ä»¥åœ¨ä¼˜åŒ–åˆæœŸé‡è§†æˆæœ¬,åæœŸæ›´å…³æ³¨PAR,å®ç°å¤šç›®æ ‡å¹³è¡¡ä¼˜åŒ–ã€‚"""
    )

    # ========== åº”ç”¨åœºæ™¯ç±» ==========
    print("ğŸ  æ·»åŠ åº”ç”¨åœºæ™¯...")

    preparer.add_qa_pair(
        instruction="å®¶åº­èƒ½æºè°ƒåº¦é—®é¢˜æ˜¯ä»€ä¹ˆ?",
        output="""å®¶åº­èƒ½æºè°ƒåº¦é—®é¢˜æ˜¯æŒ‡åœ¨æ»¡è¶³ç”¨æˆ·éœ€æ±‚çš„å‰æä¸‹,é€šè¿‡ä¼˜åŒ–å®¶ç”µè®¾å¤‡çš„è¿è¡Œæ—¶é—´,
é™ä½ç”µè´¹æˆæœ¬å¹¶å‡å°‘å³°å€¼è´Ÿè½½(PAR)çš„é—®é¢˜ã€‚
è¿™æ˜¯ä¸€ä¸ªé«˜ç»´ã€å¤šçº¦æŸã€å¤šç›®æ ‡çš„ç¦»æ•£ä¼˜åŒ–é—®é¢˜,éœ€è¦è€ƒè™‘:
- è®¾å¤‡çš„è¿è¡Œæ—¶é—´çª—å£
- ç”µä»·çš„åˆ†æ—¶å˜åŒ–
- ç”¨æˆ·çš„èˆ’é€‚åº¦è¦æ±‚
- å³°å€¼å¹³å‡æ¯”(PAR)çš„æ§åˆ¶"""
    )

    preparer.add_qa_pair(
        instruction="ä»€ä¹ˆæ˜¯å³°å€¼å¹³å‡æ¯”(PAR)?",
        output="""å³°å€¼å¹³å‡æ¯”(Peak-to-Average Ratio, PAR)æ˜¯è¡¡é‡è´Ÿè½½å‡è¡¡ç¨‹åº¦çš„æŒ‡æ ‡ã€‚
è®¡ç®—å…¬å¼: PAR = å³°å€¼è´Ÿè½½ / å¹³å‡è´Ÿè½½
PARè¶Šå°,è¯´æ˜è´Ÿè½½åˆ†å¸ƒè¶Šå‡åŒ€,å¯¹ç”µç½‘è¶Šå‹å¥½ã€‚
åœ¨å®¶åº­èƒ½æºè°ƒåº¦ä¸­,é™ä½PARå¯ä»¥å‡è½»ç”µç½‘å‹åŠ›,é¿å…å³°æ—¶æ‹¥å µã€‚"""
    )

    # ========== å®éªŒç»“æœç±» ==========
    print("ğŸ“Š æ·»åŠ å®éªŒç»“æœ...")

    preparer.add_qa_pair(
        instruction="DLM MRFOåœ¨ç®€å•åœºæ™¯ä¸‹çš„ä¼˜åŒ–æ•ˆæœå¦‚ä½•?",
        output="""åœ¨ç®€å•åœºæ™¯(10ä¸ªè®¾å¤‡)ä¸‹,DLM MRFOç®—æ³•çš„ä¼˜åŒ–æ•ˆæœä¸º:
- ç›¸æ¯”MRFOç®—æ³•: æˆæœ¬é™ä½7.89%,PARé™ä½9.55%
- ç›¸æ¯”æœªè°ƒåº¦åœºæ™¯: æˆæœ¬é™ä½45.30%,PARé™ä½33.91%
æ—¥æ€»æˆæœ¬ä¸º364.4ç¾åˆ†ã€‚"""
    )

    preparer.add_qa_pair(
        instruction="DLM MRFOåœ¨å¤æ‚åœºæ™¯ä¸‹çš„ä¼˜åŒ–æ•ˆæœå¦‚ä½•?",
        output="""åœ¨å¤æ‚åœºæ™¯(20ä¸ªè®¾å¤‡)ä¸‹,DLM MRFOç®—æ³•çš„ä¼˜åŒ–æ•ˆæœä¸º:
- ç›¸æ¯”MRFOç®—æ³•: æˆæœ¬é™ä½5.89%,PARé™ä½16.82%
- ç›¸æ¯”æœªè°ƒåº¦åœºæ™¯: æˆæœ¬é™ä½53.29%,PARé™ä½43.67%
æ—¥æ€»æˆæœ¬ä¸º653.1ç¾åˆ†ã€‚
è¿™è¡¨æ˜DLM MRFOåœ¨é«˜ç»´ç¦»æ•£è°ƒåº¦åœºæ™¯ä¸‹å…·æœ‰æ›´å¼ºçš„ä¼˜åŒ–èƒ½åŠ›ã€‚"""
    )

    preparer.add_qa_pair(
        instruction="åœ¨å¤æ‚åœºæ™¯ä¸‹,DLM MRFOç›¸æ¯”MRFOé™ä½äº†å¤šå°‘æˆæœ¬?",
        output="""åœ¨å¤æ‚åœºæ™¯ä¸‹,DLM MRFOç®—æ³•ç›¸æ¯”åŸå§‹MRFOç®—æ³•é™ä½äº†5.89%çš„æˆæœ¬ã€‚"""
    )

    # ========== æŠ€æœ¯ç»†èŠ‚ç±» ==========
    print("âš™ï¸  æ·»åŠ æŠ€æœ¯ç»†èŠ‚...")

    preparer.add_qa_pair(
        instruction="MRFOç®—æ³•çš„é“¾å¼è§…é£Ÿå¦‚ä½•æ›´æ–°ä½ç½®?",
        output="""åœ¨é“¾å¼è§…é£Ÿä¸­,è é²¼çš„ä½ç½®æ›´æ–°å…¬å¼ä¸º:
- å¯¹äºç¬¬1ä¸ªä¸ªä½“: X_i(t+1) = X_i(t) + rÂ·(X_best(t) - X_i(t)) + Î±Â·(X_best(t) - X_i(t))
- å¯¹äºç¬¬iä¸ªä¸ªä½“(iâ‰¥2): X_i(t+1) = X_i(t) + rÂ·(X_{i-1}(t) - X_i(t)) + Î±Â·(X_best(t) - X_i(t))
å…¶ä¸­X_bestæ˜¯å½“å‰æœ€ä¼˜ä½ç½®,rå’ŒÎ±æ˜¯éšæœºå‚æ•°ã€‚"""
    )

    preparer.add_qa_pair(
        instruction="DLM MRFOçš„å˜å¼‚æ“ä½œæ˜¯ä»€ä¹ˆ?",
        output="""DLM MRFOå€Ÿé‰´é—ä¼ ç®—æ³•çš„å˜å¼‚æ“ä½œ,åœ¨è¿­ä»£è¿‡ç¨‹ä¸­å¯¹éƒ¨åˆ†ä¸ªä½“è¿›è¡Œéšæœºæ‰°åŠ¨ã€‚
å˜å¼‚å¯ä»¥å¢åŠ ç§ç¾¤å¤šæ ·æ€§,å¸®åŠ©ç®—æ³•è·³å‡ºå±€éƒ¨æœ€ä¼˜ã€‚
å˜å¼‚æ¦‚ç‡é€šå¸¸è®¾ç½®ä¸º0.1-0.2,å¯¹é€‰ä¸­çš„ä¸ªä½“éšæœºæ”¹å˜å…¶éƒ¨åˆ†ç»´åº¦çš„å€¼ã€‚"""
    )

    # ========== å¯¹æ¯”åˆ†æç±» ==========
    print("ğŸ” æ·»åŠ å¯¹æ¯”åˆ†æ...")

    preparer.add_qa_pair(
        instruction="MRFOç®—æ³•çš„ä¸»è¦ä¼˜åŠ¿æ˜¯ä»€ä¹ˆ?",
        output="""MRFOç®—æ³•çš„ä¸»è¦ä¼˜åŠ¿åŒ…æ‹¬:
1. å…¨å±€æ¢ç´¢èƒ½åŠ›å¼º: é€šè¿‡ä¸‰ç§è§…é£Ÿç­–ç•¥å®ç°å…¨é¢æœç´¢
2. æ”¶æ•›é€Ÿåº¦å¿«: é“¾å¼è§…é£Ÿæœºåˆ¶åŠ é€Ÿæ”¶æ•›
3. å‚æ•°å°‘: ç›¸æ¯”å…¶ä»–å…ƒå¯å‘å¼ç®—æ³•,éœ€è¦è°ƒæ•´çš„å‚æ•°è¾ƒå°‘
4. åº”ç”¨å¹¿æ³›: åœ¨å·¥ç¨‹ä¼˜åŒ–ã€è°ƒåº¦é—®é¢˜ç­‰é¢†åŸŸè¡¨ç°å‡ºè‰²"""
    )

    preparer.add_qa_pair(
        instruction="MRFOç®—æ³•çš„å±€é™æ€§æ˜¯ä»€ä¹ˆ?",
        output="""åŸå§‹MRFOç®—æ³•å­˜åœ¨ä»¥ä¸‹å±€é™æ€§:
1. ç§ç¾¤å¤šæ ·æ€§å®¹æ˜“è¿‡æ—©ä¸§å¤±
2. å®¹æ˜“é™·å…¥å±€éƒ¨æœ€ä¼˜
3. å¯¹ç¦»æ•£é—®é¢˜çš„é€‚åº”æ€§ä¸è¶³
4. åœ¨å¤šç›®æ ‡ä¼˜åŒ–æ—¶éš¾ä»¥å¹³è¡¡ä¸åŒç›®æ ‡
è¿™äº›é—®é¢˜å¯ä»¥é€šè¿‡DLM MRFOçš„æ”¹è¿›ç­–ç•¥æ¥ç¼“è§£ã€‚"""
    )

    # ========== æ›´å¤šæ•°æ®(ä½ å¯ä»¥ç»§ç»­æ·»åŠ ) ==========
    print("â• å¯ä»¥ç»§ç»­æ·»åŠ æ›´å¤šæ•°æ®...\n")

    # æ˜¾ç¤ºç»Ÿè®¡
    preparer.show_stats()

    # ä¿å­˜
    preparer.save("mrfo_training_data.json")

    print("\n" + "=" * 70)
    print("âœ… è®­ç»ƒæ•°æ®å‡†å¤‡å®Œæˆ!")
    print("=" * 70)
    print("\nğŸ’¡ æç¤º:")
    print("   1. è®­ç»ƒæ•°æ®è¶Šå¤šè¶Šå¥½,å»ºè®®å‡†å¤‡30-50æ¡")
    print("   2. å¯ä»¥ä»è®ºæ–‡ä¸­ç»§ç»­æå–æ›´å¤šQAå¯¹")
    print("   3. ç¡®ä¿ç­”æ¡ˆå‡†ç¡®,æ¨¡å‹ä¼šå­¦ä¹ è¿™äº›å†…å®¹")

    return preparer


def view_dataset(filepath: str = "mrfo_training_data.json"):
    """
    æŸ¥çœ‹è®­ç»ƒæ•°æ®é›†
    """
    with open(filepath, 'r', encoding='utf-8') as f:
        data = json.load(f)

    print(f"\nğŸ“– è®­ç»ƒæ•°æ®é›†é¢„è§ˆ ({len(data)}æ¡)")
    print("=" * 70)

    for i, item in enumerate(data, 1):
        print(f"\n[{i}]")
        print(f"é—®é¢˜: {item['instruction']}")
        print(f"ç­”æ¡ˆ: {item['output'][:150]}...")
        print("-" * 70)


if __name__ == "__main__":
    # åˆ›å»ºæ•°æ®é›†
    preparer = create_mrfo_dataset()

    # é¢„è§ˆ
    print("\n")
    view_dataset()